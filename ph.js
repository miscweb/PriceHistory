var UIExtension=function(){var t="strictmodeoff@gmail.com",n="https://raw.githubusercontent.com/miscweb/PriceHistory/"+APP_VERSION+"/images/y2/";return{Dom:function(){return $},Url:function(t){return n+t},Sort:function(t){$(".phcontainer.status"+t).get().reverse().forEach(function(t){var n=(t=$(t).parents(".app_search_results_feed_item_holder")).prevAll();n.length>0&&t.insertBefore(n[n.length-1])})},Paint:function(n){var e=$('<div class="phico" style="position:absolute;display:table;bottom:5px;right:5px;width: 100px;height: 50px;border: 2px solid rgb(255,255,255);border-radius: 10%;cursor:pointer;opacity:0.9;box-shadow: 3px 4px 4px rgba(0,0,0,0.2);background-color:#00B53E;"/>'),i=$('<div style="padding:5px 5px 5px;"/>');e.append(i);var a=$("<img style='width:40px;height:40px;' src='"+UIExtension.Url("test.png")+"'/>");a.click(function(){if(n&&n.length>0){var t=[];n.forEach(function(n,e){t.push({id:n.id,uid:n.uid,status:e%2==0?1:2,fd:n.d,history:[{d:n.d,p:e%2==0?n.p+1:n.p-1}]})}),ph.UI(t),tr.Event({category:document.location.hostname,action:"click",label:"demo"})}}),i.append(a),(a=$("<a href='mailto:"+t+"' target='_top'><img style='width:40px;height:40px;' src='"+UIExtension.Url("mail.png")+"'/></a>")).click(function(){tr.Event({category:document.location.hostname,action:"click",label:"mail"})}),i.append(a),e.insertBefore("#app_search_results_search_button"),(e=$('<div class="app_sort_menu_item">מחיר יורד</div>')).click(function(){UIExtension.Sort(1)}),$("#app_sort_menu_holder").append(e),(e=$('<div class="app_sort_menu_item">מחיר עולה</div>')).click(function(){UIExtension.Sort(2)}),$("#app_sort_menu_holder").append(e)}}}(),tr={Init:function(t){return ga("create",t,"auto"),this},PageView:function(){ga("send","pageview")},Event:function(t){ga("send","event",t.category,t.action,t.label)}},storage={Get:function(t,n){var e={};t.forEach(function(t){e[t]=JSON.parse(localStorage.getItem(t))}),n&&n(e)},Set:function(t,n){Object.keys(t).forEach(function(n){localStorage.setItem(n,JSON.stringify(t[n]))}),n&&n()},Clear:function(t,n){t.forEach(function(t){localStorage.removeItem(t)}),n&&n()}},utils={SetUrlQS:function(t,n,e){var i=new RegExp("([?&])"+n+"=.*?(&|$|#)","i");if(t.match(i))return t.replace(i,"$1"+n+"="+e+"$2");var a="",o=t.indexOf("#");return-1!==o&&(a=t.substring(o),t=t.substring(0,o)),t+(-1!==t.indexOf("?")?"&":"?")+n+"="+e+a}},myad2={PagedUrl:function(t,n){return utils.SetUrlQS(t,"Page",n)},Scrap:function(t){var n=[],e=(new Date).toJSON().slice(0,10).split("-");return e[0]=e[0].slice(-2),e=e.reverse().join("."),t.find(".ad_feed_ad_item_price_list_layout").each(function(t,i){var a=$(i).parents(".ad_feed_ad_item_list_layout"),o=a.attr("data-ad-id").substring(a.attr("data-ad-id").lastIndexOf("_")+1),r=(((a.find(".ad_feed_ad_item_info_line2_list_layout")[0]||{}).innerText||"").match(/[a-zA-Z]*((\d{1,2})([./])(\d{1,2})([./])(\d{2,4})).*/)||[])[1]||e;n.push({id:o,p:parseFloat(((i.innerText||"").match(/\d/g)||[]).join("")||0),d:r,uid:a.attr("id")})}),n},UI:function(t,n){t.forEach(function(t){var e=$(n.Dom().find("#"+t.uid));if(0==e.find(".phcontainer").length){e.css("height","auto");var i=$("<div class='phcontainer status"+t.status+"' style='position: relative;z-index: 1;'/>");e.append(i),i.append("<img src='"+n.Url("status"+t.status+".png")+"'>"),i.click(function(n){var e=i.find(".tooltiptext");if(0==e.length){e=$('<div class="tooltiptext" style="direction:rtl;background-color: #555;color: #fff;text-align: center;border-radius: 6px;padding: 8px 0"> </div>');for(var a=t.history.length-1;a>=0;a--)e.append("<div><span>"+t.history[a].d+"</span> - <span>"+t.history[a].p.toLocaleString()+"&nbsp;₪</span></div>");t.fd&&e.append("<div><span>נצפה לראשונה</span> - <span>"+t.fd+"</span></div>"),i.append(e)}else e.toggle();n.stopPropagation()})}})}},ph=function(){var t,n,e,i={maxdata:200,maxhistory:2,engines:{myad2:{}}},a={"m.yad2.co.il":{id:"myad2",engine:myad2,matches:/m.yad2.co.il/i}};return{Init:function(t){return e=t,t&&t.domain&&(e.domain=e.domain.replace("www.","")),this},Entitled:function(t,n,e){ph.Entitlements(function(i){var a=!1,o=i[t];if(o)switch(t){case"engines":a=void 0!=o[n];break;default:a=o>=n}e&&e(a)})},Entitlements:function(n){t?n&&n(t):storage.Get(["entitlements"],function(e){t=(e||{}).entitlements||i,n&&n(t)})},Factory:function(t){t=t||e.domain;var n=a[t];return n||Object.keys(a).some(function(e){return!!t.match(a[e].matches)&&(n=a[e],!0)}),n},Run:function(t,e){if(n){var i=$(t||document),a=n.engine.Scrap(i);a.length>0?ph.Scan(a,function(t){e&&e(t,a)}):e&&e()}else{var o=ph.Factory();o?ph.Entitled("engines",o.id,function(i){i?(n=o,ph.Run(t,e)):e&&e()}):e&&e()}},Scan:function(t,e){storage.Get([n.id],function(i){var a=[],o=(i||{})[n.id]||{data:{}},r=Object.keys(o.data);ph.Entitlements(function(i){t.forEach(function(t){var n=o.data[t.id];n?(t.p!=n.p&&(n.status=t.p>n.p?2:1,i.maxhistory>0&&(n.history=n.history||[],n.history.push({d:n.d,p:n.p}),n.history.length>i.maxhistory&&(n.history=n.history.slice(1))),n.d=t.d,n.p=t.p),n.status&&a.push({id:t.id,uid:t.uid,status:n.status,fd:n.fd,history:n.history})):i.maxdata>0&&(o.data[t.id]={d:t.d,p:t.p,fd:t.d},r.push(t.id),r.length>i.maxdata&&(delete o.data[r[0]],r=r.slice(1)))});var s={};s[n.id]=o,storage.Set(s),e&&e(a)})})},UI:function(t){n.engine.UI(t,e.uiext)}}}();